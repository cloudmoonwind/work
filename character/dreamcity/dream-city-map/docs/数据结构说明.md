# 数据结构说明

## 1. locations.json - 地点数据结构

```json
{
  "locations": [
    {
      "id": "loc_001",           // 唯一标识
      "name": "中央喷泉广场",      // 地点名称
      "type": "public",          // 类型: public(公共) / private(私人)
      "category": "plaza",       // 分类: plaza/school/shop/residential等
      "position": {              // 坐标
        "x": 500,                // SVG坐标系统
        "y": 400
      },
      "zoneId": "zone_005",      // 所属区域ID
      "nearestNodes": [          // 最近的道路节点（用于路径显示）
        "node_012",
        "node_013"
      ],
      "status": "active",        // 状态: active/closed/construction
      "description": "城市的中心地标", // 描述
      "capacity": 100,           // 容量（可选）
      "openHours": "00:00-24:00", // 开放时间（可选）
      "tags": ["landmark", "meeting"], // 标签
      "interactions": [          // 可互动内容
        "rest",
        "meet",
        "event"
      ]
    }
  ]
}
```

### 地点类型分类

**公共场所（public - 天蓝色）**：
- plaza（广场）：中央喷泉广场
- education（教育）：学校、图书馆
- medical（医疗）：医院
- commercial（商业）：商业街、小吃街、超市、书店
- entertainment（娱乐）：游戏大厅、网吧、体育馆
- cultural（文化）：钟楼、天文台
- service（服务）：修理铺、24小时便利店、流浪动物收容所
- nature（自然）：公园、花园、湖

**私人区域（private - 浅粉色）**：
- residential（居住）：xx小区

**特殊区域**：
- river（河流）：城内河流与小石桥

## 2. roadNetwork.json - 道路网络结构

```json
{
  "nodes": [
    {
      "id": "node_001",          // 节点ID
      "position": {
        "x": 250,
        "y": 200
      },
      "type": "intersection",    // 类型: intersection(路口)/junction(连接点)/endpoint(端点)
      "connectedTo": [           // 连接的节点
        "node_002",
        "node_005",
        "node_008"
      ]
    }
  ],
  "roads": [
    {
      "id": "road_001",
      "from": "node_001",        // 起始节点
      "to": "node_002",          // 终止节点
      "path": [                  // 贝塞尔曲线控制点（可选，用于美化）
        {"x": 250, "y": 200},
        {"x": 280, "y": 220, "control": true},
        {"x": 300, "y": 250}
      ],
      "width": 8,                // 道路宽度
      "type": "main"             // 类型: main(主干道)/branch(支路)
    }
  ]
}
```

### 道路网络设计原则

1. **节点密度**：城市中心密集，边缘稀疏
2. **连接规则**：每个节点连接2-5个其他节点
3. **曲线美化**：主要路口使用贝塞尔曲线平滑过渡
4. **层级分明**：主干道(width:10) + 支路(width:6)

## 3. zones.json - 区域划分结构

```json
{
  "zones": [
    {
      "id": "zone_001",
      "name": "商业中心区",
      "boundary": [              // 多边形边界（道路围成）
        {"x": 400, "y": 300},
        {"x": 500, "y": 300},
        {"x": 520, "y": 400},
        {"x": 380, "y": 400}
      ],
      "boundaryNodes": [         // 边界道路节点
        "node_010",
        "node_011",
        "node_015",
        "node_014"
      ],
      "center": {                // 区域中心点（用于放置地点）
        "x": 450,
        "y": 350
      },
      "area": 12000,             // 面积（用于判断是否拥挤）
      "maxLocations": 3,         // 建议最大地点数
      "locationsCount": 2,       // 当前地点数
      "district": "central"      // 所属地区
    }
  ]
}
```

### 区域规划原则

1. **大小适中**：每个区域面积8000-15000单位
2. **形状自然**：不规则多边形，避免完美矩形
3. **留白空间**：30-40%区域保持空白
4. **功能聚集**：相似功能地点在相邻区域

## 4. mapConfig.json - 地图配置结构

```json
{
  "viewport": {
    "width": 1000,
    "height": 1200,
    "padding": 50
  },
  "cityBoundary": {
    "shape": "ginkgo",           // 银杏叶形状
    "path": "M500,100 Q400,150...", // SVG路径定义
    "fill": "#FFF9E6",           // 城市底色（米黄）
    "stroke": "#D4A574",         // 城墙颜色（深黄）
    "strokeWidth": 4
  },
  "outerRegions": [
    {
      "id": "region_east",
      "name": "东部沙滩海洋",
      "direction": "east",
      "colors": {
        "primary": "#4A90E2",    // 蓝色
        "gradient": ["#87CEEB", "#1E90FF"]
      },
      "boundary": {               // 与城市的渐变边界
        "type": "gradient",
        "width": 50,              // 渐变宽度
        "path": "M700,200 Q750,400..."
      },
      "pattern": "wave",          // 图案：wave/mountain/grass/tree
      "opacity": 0.3
    }
  ],
  "roadStyle": {
    "stroke": "#D4A574",          // 深黄色边线
    "fill": "#FFFFFF",            // 白色填充
    "strokeWidth": 2,
    "opacity": 0.9
  },
  "locationStyle": {
    "public": {
      "fill": "#A8D8EA",          // 天蓝色
      "stroke": "#D4A574",
      "radius": 20
    },
    "private": {
      "fill": "#FFB6C1",          // 浅粉色
      "stroke": "#D4A574",
      "radius": 20
    }
  }
}
```

## 5. 坐标系统说明

### SVG坐标系统
- **原点**：左上角(0, 0)
- **X轴**：向右递增，范围0-1000
- **Y轴**：向下递增，范围0-1200
- **单位**：像素（支持矢量缩放）

### 银杏叶形状定义
```
       北部（窄）
          ||
         /  \
        /    \
       |      |
       |      |  城市主体
       |      |
        \    /
         \  /
     南部（宽扇形）
```

- **南部宽度**：约700像素
- **北部宽度**：约300像素
- **高度**：约1000像素
- **中心线**：x=500

## 6. 数据关联关系

```
Location (地点)
  ├─ position (x, y)
  ├─ zoneId ──→ Zone (所属区域)
  └─ nearestNodes[] ──→ RoadNode[] (最近节点)

Zone (区域)
  ├─ boundary[] (多边形顶点)
  ├─ boundaryNodes[] ──→ RoadNode[] (边界节点)
  └─ center (中心坐标)

RoadNode (道路节点)
  ├─ position (x, y)
  └─ connectedTo[] ──→ RoadNode[] (连接节点)

Road (道路)
  ├─ from ──→ RoadNode
  ├─ to ──→ RoadNode
  └─ path[] (曲线路径)
```

## 7. 扩展字段建议

未来可以添加的字段：

```json
{
  "weather": {
    "current": "sunny",
    "effects": ["brightness:1.2"]
  },
  "timeOfDay": {
    "hour": 14,
    "lighting": "day"
  },
  "events": [
    {
      "type": "festival",
      "active": true,
      "decorations": ["lanterns"]
    }
  ],
  "characters": [
    {
      "id": "ai_001",
      "position": {"x": 450, "y": 350},
      "status": "idle"
    }
  ]
}
```

## 8. 性能优化建议

1. **数据分层加载**：
   - 第一层：地图轮廓、主干道
   - 第二层：区域、支路
   - 第三层：地点标记、详细信息

2. **空间索引**：
   - 使用四叉树或网格索引快速查找附近地点
   - 缓存常用路径计算结果

3. **渲染优化**：
   - 视口裁剪：只渲染可见区域
   - LOD：远处简化显示
   - 分层Canvas：静态层+动态层
